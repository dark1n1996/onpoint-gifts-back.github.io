!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t,n){var r,o;void 0===(r="function"==typeof(r=o=function(){function a(){for(var e=0,t={};e<arguments.length;e++){var n,r=arguments[e];for(n in r)t[n]=r[n]}return t}function c(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function e(u){function s(){}function n(e,t,n){if("undefined"!=typeof document){"number"==typeof(n=a({path:"/"},s.defaults,n)).expires&&(n.expires=new Date(+new Date+864e5*n.expires)),n.expires=n.expires?n.expires.toUTCString():"";try{var r=JSON.stringify(t);/^[\{\[]/.test(r)&&(t=r)}catch(e){}t=u.write?u.write(t,e):encodeURIComponent(String(t)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=encodeURIComponent(String(e)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var o,i="";for(o in n)n[o]&&(i+="; "+o,!0!==n[o]&&(i+="="+n[o].split(";")[0]));return document.cookie=e+"="+t+i}}function t(e,t){if("undefined"!=typeof document){for(var n={},r=document.cookie?document.cookie.split("; "):[],o=0;o<r.length;o++){var i=r[o].split("="),s=i.slice(1).join("=");t||'"'!==s.charAt(0)||(s=s.slice(1,-1));try{var a=c(i[0]),s=(u.read||u)(s,a)||c(s);if(t)try{s=JSON.parse(s)}catch(e){}if(n[a]=s,e===a)break}catch(e){}}return e?n[e]:n}}return s.set=n,s.get=function(e){return t(e,!1)},s.getJSON=function(e){return t(e,!0)},s.remove=function(e,t){n(e,"",a(t,{expires:-1}))},s.defaults={},s.withConverter=e,s}(function(){})})?r.call(t,n,t,e):r)||(e.exports=r),e.exports=o()},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}n.r(t);var o=(r(i.prototype,[{key:"_postRequestSignup",value:function(e,t,n,r,o){return fetch(this.config+e,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:r,name:o})})}},{key:"_postRequestSignin",value:function(e,t,n,r){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:r})})}},{key:"_getRequestUser",value:function(e,t){return fetch(this.config+e,{method:t,credentials:"include"})}},{key:"_postRequestCreateGift",value:function(e,t,n,r,o){return fetch(this.config+e,{method:t,credentials:"include",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:n,competence:r,comment:o})})}},{key:"signup",value:function(e,t,n){return this._postRequestSignup("signup","POST",e,t,n)}},{key:"signin",value:function(e,t){return this._postRequestSignin("signin","POST",e,t)}},{key:"getUser",value:function(){return this._getRequestUser("users/me","GET")}},{key:"giftStar",value:function(e,t,n){return this._postRequestCreateGift("donats","POST",e,t,n)}}]),i);function i(e){!function(e){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}(this),this.config=e}function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var a=(s(C.prototype,[{key:"_validateInputElement",value:function(e,t){return e.validity.valueMissing?t.textContent=this.errors.requiredText:e.validity.typeMismatch?t.textContent=this.errors.requiredEmail:"password"===e.name&&e.validity.tooShort?t.textContent=this.errors.validationLengthPass:"Выберите из списка"==e.value?t.textContent=this.errors.selectInList:t.textContent=""}},{key:"_validateForm",value:function(e,t){t.disabled=!e.checkValidity(),e.checkValidity()?t.classList.remove("form__button_off"):t.classList.add("form__button_off")}},{key:"setEventListeners",value:function(t){var n=this,r=t.querySelector(".form__button");t.addEventListener("input",function(e){n._validateInputElement(e.target,e.target.closest(".form__wrapper").querySelector(".form__error")),n._validateForm(t,r)})}},{key:"setServerError",value:function(e,t){e.textContent=t}}]),C),t=n(0),u=n.n(t),c=document.querySelector(".popup__signup"),l=document.querySelector(".popup__gift"),f=document.querySelector(".signin"),d=document.querySelector(".signup"),t=document.querySelector("header"),p=document.querySelector(".gift"),m=p.querySelector(".gift__stars span"),v=t.querySelector(".header__rules"),_=t.querySelector(".header__intro"),y=t.querySelector(".header__name"),g=f.querySelector("form"),h=d.querySelector("form"),S=p.querySelector("form"),w=new o("http://localhost:3000/"),a=new a({validationLengthPass:"Должно быть не менее 5 символов",requiredText:"Это обязательное поле",requiredEmail:"Здесь должна быть электронная почта",selectInList:"Нужно сделать выбор!"},h,g);function C(e,t,n){!function(e){if(!(e instanceof C))throw new TypeError("Cannot call a class as a function")}(this),this.errors=e,this.signupForm=t,this.signinForm=n}a.setEventListeners(h),a.setEventListeners(g),a.setEventListeners(S),document.addEventListener("click",function(e){e.target.classList.contains("form__span_signup")&&(f.classList.remove("signin_off"),d.classList.add("signin_off")),e.target.classList.contains("form__span_signin")&&(f.classList.add("signin_off"),d.classList.remove("signin_off")),e.target.classList.contains("popup__close")&&(c.classList.remove("popup_on"),l.classList.remove("popup_on")),e.target.classList.contains("gift__logout-span")&&(u.a.remove("jwt","localhost"),window.location.reload())}),h.addEventListener("submit",function(e){d.querySelector(".form__server-error").textContent="",w.signup(h.elements.email.value,h.elements.password.value,h.elements.name.value).then(function(e){if(e.ok&&c.classList.add("popup_on"),409===e.status)throw new Error("Пользователь с такой электронной почтой уже существует");if(500===e.status)throw new Error("Ошибка на сервере");return e.json()}).catch(function(e){d.querySelector(".form__server-error").textContent=e}),h.elements.email.value="",h.elements.password.value="",e.preventDefault()}),g.addEventListener("submit",function(e){w.signin(g.elements.email.value,g.elements.password.value).then(function(e){if(e.ok&&(f.classList.add("signin_off"),d.classList.add("signup_off"),p.classList.remove("gift_off"),v.classList.remove("header__rules_off"),_.classList.add("header__intro_off"),f.querySelector(".form__server-error").textContent=""),401===e.status)throw new Error("Неправильные почта или пароль");if(500===e.status)throw new Error("Ошибка на сервере");return e.json()}).then(function(e){var t=e.name.split(" ");y.textContent=t[0],m.textContent=e.starsToGiftQuantity}).catch(function(e){f.querySelector(".form__server-error").textContent=e}),e.preventDefault()}),w.getUser().then(function(e){if(e.ok&&(f.classList.add("signin_off"),d.classList.add("signup_off"),p.classList.remove("gift_off"),v.classList.remove("header__rules_off"),_.classList.add("header__intro_off")),500===e.status)throw new Error("Ошибка на сервере");if(404===e.status)throw new Error("Ошибка 404");if(401===e.status)throw new Error("Требуется аутентификация");return e.json()}).then(function(e){var t=e.user.name.split(" ");y.textContent=t[0],m.textContent=e.user.starsToGiftQuantity}).catch(function(e){console.log(e)}),S.addEventListener("submit",function(e){return 0==m.textContent?(e.preventDefault(),p.querySelector(".form__server-error").textContent="К сожалению, у Вас закончились звезды :("):(w.giftStar(S.elements.name.value,S.elements.competence.value,S.elements.comment.value).then(function(e){return e.ok&&(l.classList.add("popup_on"),S.elements.comment.value="",p.querySelector(".form__server-error").textContent=""),e.json()}).then(function(e){e.error?p.querySelector(".form__server-error").textContent=e.error:m.textContent=m.textContent-1}).catch(function(e){p.querySelector(".form__server-error").textContent=e}),void e.preventDefault())})}]);